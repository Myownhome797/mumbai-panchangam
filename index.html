<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Time Based Lookup</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  .box { border: 1px solid #ccc; padding: 15px; margin-top: 10px; }
</style>
</head>
<body>

<h2>Current Time Based Record</h2>
<div id="output" class="box">Loadingâ€¦</div>

<script>
async function loadData() {
  const nowLocal = new Date();

  document.getElementById("output").innerHTML = `
  <b>Your current local time is: </b>
  ${nowLocal.toLocaleString(undefined, { timeZoneName: "short" })}
`;
  const response = await fetch("data.csv");
  const text = await response.text();

  const lines = text.trim().split("\n");

  // ---- PARSE HEADER ----
  const headers = lines[0].split(",");
  const idx = name => headers.indexOf(name);

  // ---- DATA ROWS ----
  const rows = lines.slice(1);

  // Current time in UTC (ms since epoch)
  const nowUTC = Date.now();

  for (const row of rows) {
    const cols = row.split(",");

    // ---- FROM (UTC) ----
    const fromUTC = Date.parse(
      `${cols[idx("from_date")].slice(0,4)}-${cols[idx("from_date")].slice(4,6)}-${cols[idx("from_date")].slice(6,8)}T` +
      `${cols[idx("from_hh")].padStart(2,"0")}:${cols[idx("from_mm")].padStart(2,"0")}:00Z`
    );

    // ---- TO (UTC) ----
    const toUTC = Date.parse(
      `${cols[idx("to_date")].slice(0,4)}-${cols[idx("to_date")].slice(4,6)}-${cols[idx("to_date")].slice(6,8)}T` +
      `${cols[idx("to_hh")].padStart(2,"0")}:${cols[idx("to_mm")].padStart(2,"0")}:00Z`
    );

    // ---- MATCH CHECK ----
    if (nowUTC >= fromUTC && nowUTC <= toUTC) {
      const fromLocal = new Date(fromUTC);
      const toLocal   = new Date(toUTC);

      document.getElementById("output").innerHTML = `
<b>Matched Record</b><br><br>

<b>From (local):</b> ${fromLocal.toLocaleString()}<br>
<b>To (local):</b> ${toLocal.toLocaleString()}<br><br>

//Thithi_0: ${cols[idx("Thithi_0")]}<br>
Thithi_1: ${cols[idx("Thithi_1")]}<br>
Varsham: ${cols[idx("Varsham")]}<br>
Chandramanam_masam: ${cols[idx("Chandramanam_masam")]}<br>
Paksham: ${cols[idx("Paksham")]}<br>
Ruthu: ${cols[idx("Ruthu")]}<br>
//from_date: ${cols[idx("from_date")]}<br>
//from_hh: ${cols[idx("from_hh")]}<br
//from_mm: ${cols[idx("from_mm")]}<br>
//to_date: ${cols[idx("to_date")]}<br>
//to_hh: ${cols[idx("to_hh")]}<br>
//to_mm: ${cols[idx("to_mm")]}
//Duration_in_mins: ${cols[idx("Duration_in_mins")]}
`;
      return; // stop after first match
    }
  }


  // runs only if no row matched
  document.getElementById("output").innerHTML =
    "No matching record for current time.";
}

loadData();
</script>


</body>
</html>
